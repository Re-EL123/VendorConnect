<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Upload Item â€” Street Connect</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
</head>

<body class="bg-gradient-to-br from-indigo-100 to-purple-100 min-h-screen flex items-center justify-center">

  <div class="bg-white/80 backdrop-blur p-8 rounded-2xl shadow max-w-lg w-full">
    <h2 class="text-2xl font-bold text-indigo-700 mb-6">Upload New Item</h2>

    <form id="uploadForm" class="space-y-4">
      <input id="title" placeholder="Item Title" class="w-full border p-2 rounded" required />
      <textarea id="description" placeholder="Description" class="w-full border p-2 rounded" required></textarea>
      <input id="price" type="number" placeholder="Price (R)" class="w-full border p-2 rounded" required />
      <input id="category" placeholder="Category" class="w-full border p-2 rounded" />
      <input id="image" type="file" accept="image/*" />

      <button class="w-full bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700">
        Upload Item
      </button>
    </form>

    <p id="msg" class="text-center text-sm mt-4"></p>
  </div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDEsYzVYNvSsKvgFk5cSa_7lWWdJtDc1gs",
  authDomain: "online-mall-4422.firebaseapp.com",
  databaseURL: "https://online-mall-4422-default-rtdb.firebaseio.com",
  projectId: "online-mall-4422",
  storageBucket: "online-mall-4422.appspot.com",
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();
const storage = firebase.storage();

auth.onAuthStateChanged(async user => {
  if (!user) return location.href = "login.html";

  const snap = await db.ref("users/" + user.uid).once("value");
  const acct = snap.val()?.accountType;

  if (!["business","pro"].includes(acct)) {
    alert("Vendor account required");
    location.href = "feed.html";
  }
});

document.getElementById("uploadForm").onsubmit = async e => {
  e.preventDefault();
  const user = auth.currentUser;

  const file = image.files[0];
  let imageUrl = "";

  if (file) {
    const ref = storage.ref(`marketplace/${user.uid}/${Date.now()}_${file.name}`);
    await ref.put(file);
    imageUrl = await ref.getDownloadURL();
  }

  const item = {
    title: title.value,
    description: description.value,
    price: Number(price.value),
    category: category.value || "",
    imageUrl,
    sellerId: user.uid,
    createdAt: Date.now()
  };

  await db.ref("marketplace").push(item);
  msg.textContent = "Item uploaded successfully";
};
</script>

</body>
</html>
