<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Street Connect ‚Äî Marketplace</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React (future ready, non-intrusive) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- Tailwind Animations -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          animation: {
            fadeUp: "fadeUp 0.6s ease-out forwards"
          },
          keyframes: {
            fadeUp: {
              "0%": { opacity: "0", transform: "translateY(20px)" },
              "100%": { opacity: "1", transform: "translateY(0)" }
            }
          }
        }
      }
    }
  </script>
</head>

<body class="bg-gradient-to-br from-indigo-100 via-blue-100 to-purple-100 min-h-screen flex flex-col">

  <!-- HEADER -->
  <header class="p-4 bg-white/80 backdrop-blur shadow flex justify-between items-center">
    <h1 class="text-xl font-extrabold text-indigo-700">Street Connect</h1>
    <button id="logoutBtn" class="text-sm text-gray-600 hover:text-indigo-600">Logout</button>
  </header>

  <!-- MAIN -->
  <main class="flex-grow p-4 max-w-5xl mx-auto w-full animate-fadeUp pb-24">

    <!-- FILTER BAR -->
    <div class="bg-white/80 backdrop-blur rounded-xl shadow p-4 mb-6 flex flex-wrap gap-3">
      <input
        id="searchInput"
        type="text"
        placeholder="Search products..."
        class="flex-grow border rounded p-2"
      />

      <select id="categoryFilter" class="border rounded p-2 w-48">
        <option value="">All Categories</option>
        <option value="Food">Food</option>
        <option value="Services">Services</option>
        <option value="Clothing">Clothing</option>
      </select>
    </div>

    <!-- ITEMS GRID -->
    <div id="itemsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>

  </main>

  <!-- BOTTOM NAV -->
  <nav class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur border-t shadow">
    <div class="max-w-5xl mx-auto flex justify-around py-3 text-sm font-medium">
      <a href="feed.html" class="flex flex-col items-center hover:text-indigo-600">
        üè†
        <span>Feed</span>
      </a>
      <a href="marketplace.html" class="flex flex-col items-center text-indigo-600">
        üõí
        <span>Marketplace</span>
      </a>
      <a href="wallet.html" class="flex flex-col items-center hover:text-indigo-600">
        üí≥
        <span>Wallet</span>
      </a>
    </div>
  </nav>

  <!-- FIREBASE + MARKETPLACE LOGIC -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDEsYzVYNvSsKvgFk5cSa_7lWWdJtDc1gs",
      authDomain: "online-mall-4422.firebaseapp.com",
      databaseURL: "https://online-mall-4422-default-rtdb.firebaseio.com",
      projectId: "online-mall-4422",
      storageBucket: "online-mall-4422.appspot.com",
      messagingSenderId: "947082232783",
      appId: "1:947082232783:web:116206502e5fb38383c8ba"
    };

    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.database();

    const itemsContainer = document.getElementById("itemsContainer");
    const searchInput = document.getElementById("searchInput");
    const categoryFilter = document.getElementById("categoryFilter");
    const logoutBtn = document.getElementById("logoutBtn");

    let allItems = [];

    /* ---------------- AUTH CHECK ---------------- */
    auth.onAuthStateChanged(user => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      fetchMarketplace();
    });

    /* ---------------- FETCH ITEMS ---------------- */
    function fetchMarketplace() {
      db.ref("marketplace").on("value", snapshot => {
        const data = snapshot.val() || {};
        allItems = Object.values(data);

        allItems.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        applyFilters();
      });
    }

    /* ---------------- FILTER ---------------- */
    function applyFilters() {
      const search = searchInput.value.toLowerCase();
      const category = categoryFilter.value;

      const filtered = allItems.filter(item => {
        return (
          (!search || item.title.toLowerCase().includes(search)) &&
          (!category || item.category === category)
        );
      });

      renderItems(filtered);
    }

    /* ---------------- RENDER ---------------- */
    function renderItems(items) {
      itemsContainer.innerHTML = "";

      if (!items.length) {
        itemsContainer.innerHTML = `
          <p class="col-span-full text-center text-gray-500">
            No items found
          </p>
        `;
        return;
      }

      items.forEach(item => {
        itemsContainer.innerHTML += `
          <div class="bg-white/80 backdrop-blur rounded-2xl shadow p-4 flex flex-col">
            ${item.imageUrl ? `
              <img src="${item.imageUrl}" class="rounded-lg h-40 w-full object-cover mb-3">
            ` : ""}

            <h3 class="font-semibold text-lg text-indigo-700">${item.title}</h3>
            <p class="text-sm text-gray-600 flex-grow">${item.description}</p>

            <div class="mt-3 flex justify-between items-center">
              <span class="font-bold text-indigo-700">R ${item.price}</span>
              <button class="bg-indigo-600 text-white px-4 py-1 rounded-lg hover:bg-indigo-700">
                View
              </button>
            </div>
          </div>
        `;
      });
    }

    /* ---------------- EVENTS ---------------- */
    searchInput.addEventListener("input", applyFilters);
    categoryFilter.addEventListener("change", applyFilters);

    logoutBtn.onclick = async () => {
      await auth.signOut();
      window.location.href = "login.html";
    };
  </script>

</body>
</html>
